<!-- CACHE_BUST_TEST_456 -->
{% extends "base.html" %}

{% block title %}Virtual Influencer Ray{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Virtual Influencer Ray</h1>
    
    <!-- Einfache Generierung -->
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Einfache Textgenerierung</h5>
            <p>Klicke hier, um einen einfachen Beispieltext mit einem festen Prompt zu generieren.</p>
            <button id="generateExampleButton" class="btn btn-secondary" onclick="generateExampleText()">
                Beispieltext Generieren
                </button>
            <div id="generationResult" class="mt-3" style="display: none;">
                <h6>Generierter Text:</h6>
                <pre><code id="generatedText"></code></pre>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script>
    async function checkApiConnection() {
        const button = document.getElementById('checkApiButton');
        const resultDiv = document.getElementById('apiStatusResult');
        resultDiv.style.display = 'block';
        resultDiv.innerHTML = '<div class="spinner-border spinner-border-sm" role="status"><span class="visually-hidden">Loading...</span></div> Wird gepr√ºft...';
        button.disabled = true;

        try {
            const response = await fetch('/api/connection/test');
            const data = await response.json();

            if (response.ok && data.status === 'success') {
                resultDiv.innerHTML = `<div class="alert alert-success" role="alert">API Verbindung erfolgreich!</div>`;
                console.log("API Test erfolgreich:", data);
            } else {
                resultDiv.innerHTML = `<div class="alert alert-danger" role="alert">API Verbindung fehlgeschlagen: ${data.error || 'Unbekannter Fehler'} (${data.error_type || 'N/A'})</div>`;
                console.error("API Test fehlgeschlagen:", data);
            }
        } catch (error) {
            resultDiv.innerHTML = `<div class="alert alert-danger" role="alert">Fehler beim Senden der Anfrage: ${error}</div>`;
            console.error("Fehler beim API Test:", error);
        } finally {
            button.disabled = false;
        }
    }

    async function generateExampleText() {
        const button = document.getElementById('generateExampleButton');
        const resultDiv = document.getElementById('generationResult');
        const textElement = document.getElementById('generatedText');
        
        resultDiv.style.display = 'block';
        textElement.textContent = 'Generiere...';
        button.disabled = true;

        try {
            const response = await fetch('/api/generate/example');
            const data = await response.json();

            if (response.ok && data.status === 'success') {
                textElement.textContent = data.content;
                console.log("Beispielgenerierung erfolgreich:", data);
            } else {
                textElement.textContent = `Fehler: ${data.error || 'Unbekannter Fehler'} (${data.details || 'N/A'})`;
                console.error("Beispielgenerierung fehlgeschlagen:", data);
            }
        } catch (error) {
            textElement.textContent = `Fehler beim Senden der Anfrage: ${error}`;
            console.error("Fehler bei Beispielgenerierung:", error);
        } finally {
            button.disabled = false;
        }
    }

</script>
{% endblock %}